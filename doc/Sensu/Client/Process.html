<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Sensu::Client::Process
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Sensu/Client/Process.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Sensu.html" title="Sensu (module)">Sensu</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Client.html" title="Sensu::Client (module)">Client</a></span></span>
     &raquo; 
    <span class="title">Process</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Sensu::Client::Process
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sensu::Client::Process</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="../Daemon.html" title="Sensu::Daemon (module)">Daemon</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/sensu/client/process.rb</dd>
  
</dl>
<div class="clear"></div>





  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#safe_mode-instance_method" title="#safe_mode (instance method)">- (Object) <strong>safe_mode</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute safe_mode.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-class_method" title="run (class method)">+ (Object) <strong>run</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create an instance of the Sensu client process, start the client within the
EventMachine event loop, and set up client process signal traps (for
stopping).</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bootstrap-instance_method" title="#bootstrap (instance method)">- (Object) <strong>bootstrap</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Bootstrap the Sensu client, setting up client keepalives, subscriptions,
and standalone check executions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_execution_splay-instance_method" title="#calculate_execution_splay (instance method)">- (Object) <strong>calculate_execution_splay</strong>(check) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate a check execution splay, taking into account the current time and
the execution interval to ensure it&#39;s consistent between process
restarts.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#complete_checks_in_progress-instance_method" title="#complete_checks_in_progress (instance method)">- (Object) <strong>complete_checks_in_progress</strong>(&amp;callback) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Call a callback (Ruby block) when there are no longer check executions in
progress.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_check_command-instance_method" title="#execute_check_command (instance method)">- (Object) <strong>execute_check_command</strong>(check) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute a check command, capturing its output (STDOUT/ERR), exit status
code, execution duration, timestamp, and publish the result.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_client_attribute-instance_method" title="#find_client_attribute (instance method)">- (Object) <strong>find_client_attribute</strong>(tree, path, default) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Traverse the Sensu client definition (hash) for an attribute value, with a
fallback default value if nil.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Process) <strong>initialize</strong>(options = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Override Daemon initialize() to support Sensu client check execution safe
mode and checks in progress.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#keepalive_payload-instance_method" title="#keepalive_payload (instance method)">- (Hash) <strong>keepalive_payload</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a Sensu client keepalive payload, to be sent over the transport for
processing.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pause-instance_method" title="#pause (instance method)">- (Object) <strong>pause</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Pause the Sensu client process, unless it is being paused or has already
been paused.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_check_request-instance_method" title="#process_check_request (instance method)">- (Object) <strong>process_check_request</strong>(check) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Process a check request.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#publish_check_result-instance_method" title="#publish_check_result (instance method)">- (Object) <strong>publish_check_result</strong>(check) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Publish a check result to the transport for processing.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#publish_keepalive-instance_method" title="#publish_keepalive (instance method)">- (Object) <strong>publish_keepalive</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Publish a Sensu client keepalive to the transport for processing.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resume-instance_method" title="#resume (instance method)">- (Object) <strong>resume</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Resume the Sensu client process if it is currently or will soon be paused.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run_check_extension-instance_method" title="#run_check_extension (instance method)">- (Object) <strong>run_check_extension</strong>(check) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Run a check extension and publish the result.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#schedule_checks-instance_method" title="#schedule_checks (instance method)">- (Object) <strong>schedule_checks</strong>(checks) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Schedule check executions, using EventMachine periodic timers, using a
calculated execution splay.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup_keepalives-instance_method" title="#setup_keepalives (instance method)">- (Object) <strong>setup_keepalives</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Schedule Sensu client keepalives.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup_sockets-instance_method" title="#setup_sockets (instance method)">- (Object) <strong>setup_sockets</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Setup the Sensu client socket, for external check result input.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup_standalone-instance_method" title="#setup_standalone (instance method)">- (Object) <strong>setup_standalone</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Setup standalone check executions, scheduling standard check definition and
check extension executions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup_subscriptions-instance_method" title="#setup_subscriptions (instance method)">- (Object) <strong>setup_subscriptions</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set up Sensu client subscriptions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-instance_method" title="#start (instance method)">- (Object) <strong>start</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Start the Sensu client process, setting up the client transport connection,
the sockets, and bootstrap.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">- (Object) <strong>stop</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Stop the Sensu client process, pausing it, completing check executions in
progress, closing the transport connection, and exiting the process (exit
0).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#substitute_check_command_tokens-instance_method" title="#substitute_check_command_tokens (instance method)">- (Array) <strong>substitute_check_command_tokens</strong>(check) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Substitue check command tokens (eg. :::db.name|production:::) with the
associated client definition attribute value.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Daemon.html" title="Sensu::Daemon (module)">Daemon</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Daemon.html#load_extensions-instance_method" title="Sensu::Daemon#load_extensions (method)">#load_extensions</a></span>, <span class='object_link'><a href="../Daemon.html#load_settings-instance_method" title="Sensu::Daemon#load_settings (method)">#load_settings</a></span>, <span class='object_link'><a href="../Daemon.html#log_concerns-instance_method" title="Sensu::Daemon#log_concerns (method)">#log_concerns</a></span>, <span class='object_link'><a href="../Daemon.html#setup_logger-instance_method" title="Sensu::Daemon#setup_logger (method)">#setup_logger</a></span>, <span class='object_link'><a href="../Daemon.html#setup_process-instance_method" title="Sensu::Daemon#setup_process (method)">#setup_process</a></span>, <span class='object_link'><a href="../Daemon.html#setup_redis-instance_method" title="Sensu::Daemon#setup_redis (method)">#setup_redis</a></span>, <span class='object_link'><a href="../Daemon.html#setup_signal_traps-instance_method" title="Sensu::Daemon#setup_signal_traps (method)">#setup_signal_traps</a></span>, <span class='object_link'><a href="../Daemon.html#setup_transport-instance_method" title="Sensu::Daemon#setup_transport (method)">#setup_transport</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Utilities.html" title="Sensu::Utilities (module)">Utilities</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Utilities.html#deep_merge-instance_method" title="Sensu::Utilities#deep_merge (method)">#deep_merge</a></span>, <span class='object_link'><a href="../Utilities.html#random_uuid-instance_method" title="Sensu::Utilities#random_uuid (method)">#random_uuid</a></span>, <span class='object_link'><a href="../Utilities.html#redact_sensitive-instance_method" title="Sensu::Utilities#redact_sensitive (method)">#redact_sensitive</a></span>, <span class='object_link'><a href="../Utilities.html#retry_until_true-instance_method" title="Sensu::Utilities#retry_until_true (method)">#retry_until_true</a></span>, <span class='object_link'><a href="../Utilities.html#testing%3F-instance_method" title="Sensu::Utilities#testing? (method)">#testing?</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sensu::Client::Process (class)">Process</a></span></tt>) <strong>initialize</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Override Daemon initialize() to support Sensu client check execution safe
mode and checks in progress.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 28</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>super</span>
  <span class='ivar'>@safe_mode</span> <span class='op'>=</span> <span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:safe_mode</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='kw'>false</span>
  <span class='ivar'>@checks_in_progress</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="safe_mode=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="safe_mode-instance_method">
  
    - (<tt>Object</tt>) <strong>safe_mode</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute safe_mode</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_safe_mode'>safe_mode</span>
  <span class='ivar'>@safe_mode</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="run-class_method">
  
    + (<tt>Object</tt>) <strong>run</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create an instance of the Sensu client process, start the client within the
EventMachine event loop, and set up client process signal traps (for
stopping).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18
19
20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 16</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='const'>EM</span><span class='op'>::</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
    <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_setup_signal_traps'>setup_signal_traps</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="bootstrap-instance_method">
  
    - (<tt>Object</tt>) <strong>bootstrap</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Bootstrap the Sensu client, setting up client keepalives, subscriptions,
and standalone check executions. This method sets the process/daemon state
to `:running`.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


347
348
349
350
351
352</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 347</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bootstrap'>bootstrap</span>
  <span class='id identifier rubyid_setup_keepalives'>setup_keepalives</span>
  <span class='id identifier rubyid_setup_subscriptions'>setup_subscriptions</span>
  <span class='id identifier rubyid_setup_standalone'>setup_standalone</span>
  <span class='ivar'>@state</span> <span class='op'>=</span> <span class='symbol'>:running</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_execution_splay-instance_method">
  
    - (<tt>Object</tt>) <strong>calculate_execution_splay</strong>(check) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate a check execution splay, taking into account the current time and
the execution interval to ensure it&#39;s consistent between process
restarts.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>check</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>definition</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259
260
261
262</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 257</span>

<span class='kw'>def</span> <span class='id identifier rubyid_calculate_execution_splay'>calculate_execution_splay</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_splay_hash'>splay_hash</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Q&lt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_current_time'>current_time</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>*</span> <span class='int'>1000</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_splay_hash'>splay_hash</span> <span class='op'>-</span> <span class='id identifier rubyid_current_time'>current_time</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:interval</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>1000</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>1000.0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="complete_checks_in_progress-instance_method">
  
    - (<tt>Object</tt>) <strong>complete_checks_in_progress</strong>(&amp;callback) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Call a callback (Ruby block) when there are no longer check executions in
progress. This method is used when stopping the Sensu client. The
`retry_until_true` helper method is used to check the condition every 0.5
seconds until `true` is returned.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>callback</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>called when there are no check executions in progress.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


334
335
336
337
338
339
340
341
342</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 334</span>

<span class='kw'>def</span> <span class='id identifier rubyid_complete_checks_in_progress'>complete_checks_in_progress</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>completing checks in progress</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:checks_in_progress</span> <span class='op'>=&gt;</span> <span class='ivar'>@checks_in_progress</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_retry_until_true'>retry_until_true</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='ivar'>@checks_in_progress</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_callback'>callback</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span>
      <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_check_command-instance_method">
  
    - (<tt>Object</tt>) <strong>execute_check_command</strong>(check) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Execute a check command, capturing its output (STDOUT/ERR), exit status
code, execution duration, timestamp, and publish the result. This method
guards against multiple executions for the same check. Check command tokens
are substituted with the associated client attribute values. If there are
unmatched check command tokens, the check command will not be executed,
instead a check result will be published reporting the unmatched tokens.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>check</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_check_command'>execute_check_command</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attempting to execute check command</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:check</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='ivar'>@checks_in_progress</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@checks_in_progress</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='id identifier rubyid_unmatched_tokens'>unmatched_tokens</span> <span class='op'>=</span> <span class='id identifier rubyid_substitute_check_command_tokens'>substitute_check_command_tokens</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_unmatched_tokens'>unmatched_tokens</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:executed</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_started'>started</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
      <span class='const'>Spawn</span><span class='period'>.</span><span class='id identifier rubyid_process'>process</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_output'>output</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='op'>|</span>
        <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:duration</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.3f</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>-</span> <span class='id identifier rubyid_started'>started</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
        <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:output</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span>
        <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_status'>status</span>
        <span class='id identifier rubyid_publish_check_result'>publish_check_result</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
        <span class='ivar'>@checks_in_progress</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:output</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unmatched command tokens: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_unmatched_tokens'>unmatched_tokens</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>3</span>
      <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:handle</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_publish_check_result'>publish_check_result</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
      <span class='ivar'>@checks_in_progress</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>previous check command execution in progress</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:check</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_client_attribute-instance_method">
  
    - (<tt>Object</tt>) <strong>find_client_attribute</strong>(tree, path, default) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Traverse the Sensu client definition (hash) for an attribute value, with a
fallback default value if nil.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>tree</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>to traverse.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>path</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>of attribute keys.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>default</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>value if attribute value is nil.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>attribute or fallback default value.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 104</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_client_attribute'>find_client_attribute</span><span class='lparen'>(</span><span class='id identifier rubyid_tree'>tree</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_default'>default</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attribute'>attribute</span> <span class='op'>=</span> <span class='id identifier rubyid_tree'>tree</span><span class='lbracket'>[</span><span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_find_client_attribute'>find_client_attribute</span><span class='lparen'>(</span><span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_default'>default</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='id identifier rubyid_default'>default</span> <span class='op'>:</span> <span class='id identifier rubyid_attribute'>attribute</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="keepalive_payload-instance_method">
  
    - (<tt>Hash</tt>) <strong>keepalive_payload</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a Sensu client keepalive payload, to be sent over the transport for
processing. A client keepalive is composed of its settings definition, the
Sensu version, and a timestamp. Sensitive information is redacted from the
keepalive payload.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>keepalive payload</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40
41
42
43
44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 40</span>

<span class='kw'>def</span> <span class='id identifier rubyid_keepalive_payload'>keepalive_payload</span>
  <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='symbol'>:version</span> <span class='op'>=&gt;</span> <span class='const'>VERSION</span><span class='comma'>,</span>
    <span class='symbol'>:timestamp</span> <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redact_sensitive'>redact_sensitive</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span> <span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:redact</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pause-instance_method">
  
    - (<tt>Object</tt>) <strong>pause</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Pause the Sensu client process, unless it is being paused or has already
been paused. The process/daemon state is first set to `:pausing`, to
indicate that it&#39;s in progress. All run timers are cancelled, and the
references are cleared. The Sensu client will unsubscribe from all
subscriptions, then set the process/daemon state to `:paused`.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


368
369
370
371
372
373
374
375
376
377
378</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 368</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pause'>pause</span>
  <span class='kw'>unless</span> <span class='ivar'>@state</span> <span class='op'>==</span> <span class='symbol'>:pausing</span> <span class='op'>||</span> <span class='ivar'>@state</span> <span class='op'>==</span> <span class='symbol'>:paused</span>
    <span class='ivar'>@state</span> <span class='op'>=</span> <span class='symbol'>:pausing</span>
    <span class='ivar'>@timers</span><span class='lbracket'>[</span><span class='symbol'>:run</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_timer'>timer</span><span class='op'>|</span>
      <span class='id identifier rubyid_timer'>timer</span><span class='period'>.</span><span class='id identifier rubyid_cancel'>cancel</span>
    <span class='kw'>end</span>
    <span class='ivar'>@timers</span><span class='lbracket'>[</span><span class='symbol'>:run</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
    <span class='ivar'>@transport</span><span class='period'>.</span><span class='id identifier rubyid_unsubscribe'>unsubscribe</span>
    <span class='ivar'>@state</span> <span class='op'>=</span> <span class='symbol'>:paused</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_check_request-instance_method">
  
    - (<tt>Object</tt>) <strong>process_check_request</strong>(check) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Process a check request. If a check request has a check command, it will be
executed. A check request without a check command indicates a check
extension run. A check request will be merged with a local check
definition, if present. Client safe mode is enforced in this method,
requiring a local check definition in order to execute the check command.
If a local check definition does not exist when operating with client safe
mode, a check result will be published to report the missing check
definition.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>check</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 200</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_check_request'>process_check_request</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>processing check</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:check</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_check'>check</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:command</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@settings</span><span class='period'>.</span><span class='id identifier rubyid_check_exists?'>check_exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_check'>check</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:checks</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_execute_check_command'>execute_check_command</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='ivar'>@safe_mode</span>
      <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:output</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Check is not locally defined (safe mode)</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>3</span>
      <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:handle</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:executed</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_publish_check_result'>publish_check_result</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_execute_check_command'>execute_check_command</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='ivar'>@extensions</span><span class='period'>.</span><span class='id identifier rubyid_check_exists?'>check_exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_run_check_extension'>run_check_extension</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unknown check extension</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:check</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="publish_check_result-instance_method">
  
    - (<tt>Object</tt>) <strong>publish_check_result</strong>(check) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Publish a check result to the transport for processing. A check result is
composed of a client (name) and a check definition, containing check output
and status. JSON serialization is used for transport messages.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>check</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 81</span>

<span class='kw'>def</span> <span class='id identifier rubyid_publish_check_result'>publish_check_result</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:client</span> <span class='op'>=&gt;</span> <span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='symbol'>:check</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_check'>check</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>publishing check result</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:payload</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
  <span class='ivar'>@transport</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:direct</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>results</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>MultiJson</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_info'>info</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed to publish check result</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span>
        <span class='symbol'>:payload</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span>
        <span class='symbol'>:error</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="publish_keepalive-instance_method">
  
    - (<tt>Object</tt>) <strong>publish_keepalive</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Publish a Sensu client keepalive to the transport for processing. JSON
serialization is used for transport messages.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 50</span>

<span class='kw'>def</span> <span class='id identifier rubyid_publish_keepalive'>publish_keepalive</span>
  <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_keepalive_payload'>keepalive_payload</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>publishing keepalive</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:payload</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
  <span class='ivar'>@transport</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:direct</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keepalives</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>MultiJson</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_info'>info</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed to publish keepalive</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span>
        <span class='symbol'>:payload</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span>
        <span class='symbol'>:error</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resume-instance_method">
  
    - (<tt>Object</tt>) <strong>resume</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Resume the Sensu client process if it is currently or will soon be paused.
The `retry_until_true` helper method is used to determine if the process is
paused and if the transport is connected. If the conditions are met,
`bootstrap()` will be called and true is returned to stop
`retry_until_true`.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


385
386
387
388
389
390
391
392
393
394</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 385</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resume'>resume</span>
  <span class='id identifier rubyid_retry_until_true'>retry_until_true</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='ivar'>@state</span> <span class='op'>==</span> <span class='symbol'>:paused</span>
      <span class='kw'>if</span> <span class='ivar'>@transport</span><span class='period'>.</span><span class='id identifier rubyid_connected?'>connected?</span>
        <span class='id identifier rubyid_bootstrap'>bootstrap</span>
        <span class='kw'>true</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run_check_extension-instance_method">
  
    - (<tt>Object</tt>) <strong>run_check_extension</strong>(check) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Run a check extension and publish the result. The Sensu client loads check
extensions, checks that run within the Sensu Ruby VM and the EventMachine
event loop, using the Sensu Extension API.</p>

<p><a
href="https://github.com/sensu/sensu-extension">github.com/sensu/sensu-extension</a></p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>check</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


178
179
180
181
182
183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 178</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run_check_extension'>run_check_extension</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attempting to run check extension</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:check</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:executed</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_extension'>extension</span> <span class='op'>=</span> <span class='ivar'>@extensions</span><span class='lbracket'>[</span><span class='symbol'>:checks</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_extension'>extension</span><span class='period'>.</span><span class='id identifier rubyid_safe_run'>safe_run</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_output'>output</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='op'>|</span>
    <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:output</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span>
    <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_status'>status</span>
    <span class='id identifier rubyid_publish_check_result'>publish_check_result</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="schedule_checks-instance_method">
  
    - (<tt>Object</tt>) <strong>schedule_checks</strong>(checks) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Schedule check executions, using EventMachine periodic timers, using a
calculated execution splay. The timers are stored in the timers hash under
`:run`, so they can be cancelled etc. Check definitions are duplicated
before processing them, in case they are mutated. The check `:issued`
timestamp is set here, to mimic check requests issued by a Sensu server.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>checks</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>of definitions.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


272
273
274
275
276
277
278
279
280
281
282
283
284
285</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 272</span>

<span class='kw'>def</span> <span class='id identifier rubyid_schedule_checks'>schedule_checks</span><span class='lparen'>(</span><span class='id identifier rubyid_checks'>checks</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_checks'>checks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_check'>check</span><span class='op'>|</span>
    <span class='id identifier rubyid_execute_check'>execute_check</span> <span class='op'>=</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:issued</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_process_check_request'>process_check_request</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_execution_splay'>execution_splay</span> <span class='op'>=</span> <span class='id identifier rubyid_testing?'>testing?</span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='id identifier rubyid_calculate_execution_splay'>calculate_execution_splay</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_interval'>interval</span> <span class='op'>=</span> <span class='id identifier rubyid_testing?'>testing?</span> <span class='op'>?</span> <span class='float'>0.5</span> <span class='op'>:</span> <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:interval</span><span class='rbracket'>]</span>
    <span class='ivar'>@timers</span><span class='lbracket'>[</span><span class='symbol'>:run</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'>EM</span><span class='op'>::</span><span class='const'>Timer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_execution_splay'>execution_splay</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_execute_check'>execute_check</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span>
      <span class='ivar'>@timers</span><span class='lbracket'>[</span><span class='symbol'>:run</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'>EM</span><span class='op'>::</span><span class='const'>PeriodicTimer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_interval'>interval</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_execute_check'>execute_check</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup_keepalives-instance_method">
  
    - (<tt>Object</tt>) <strong>setup_keepalives</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Schedule Sensu client keepalives. Immediately publish a keepalive to
register the client, then publish a keepalive every 20 seconds. Sensu
client keepalives are used to determine client (&amp; machine) health.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_keepalives'>setup_keepalives</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>scheduling keepalives</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_publish_keepalive'>publish_keepalive</span>
  <span class='ivar'>@timers</span><span class='lbracket'>[</span><span class='symbol'>:run</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'>EM</span><span class='op'>::</span><span class='const'>PeriodicTimer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>20</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_publish_keepalive'>publish_keepalive</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup_sockets-instance_method">
  
    - (<tt>Object</tt>) <strong>setup_sockets</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Setup the Sensu client socket, for external check result input. By default,
the client socket is bound to localhost on TCP &amp; UDP port 3030. The
socket can be configured via the client definition, `:socket` with `:bind`
and `:port`. The current instance of the Sensu logger, settings, and
transport are passed to the socket handler, `Sensu::Client::Socket`.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 308</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_sockets'>setup_sockets</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:socket</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:bind</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:port</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='int'>3030</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>binding client tcp and udp sockets</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:options</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='const'>EM</span><span class='op'>::</span><span class='id identifier rubyid_start_server'>start_server</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:bind</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:port</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_socket'>socket</span><span class='op'>|</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='ivar'>@logger</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span> <span class='op'>=</span> <span class='ivar'>@settings</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_transport'>transport</span> <span class='op'>=</span> <span class='ivar'>@transport</span>
  <span class='kw'>end</span>
  <span class='const'>EM</span><span class='op'>::</span><span class='id identifier rubyid_open_datagram_socket'>open_datagram_socket</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:bind</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:port</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_socket'>socket</span><span class='op'>|</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='ivar'>@logger</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span> <span class='op'>=</span> <span class='ivar'>@settings</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_transport'>transport</span> <span class='op'>=</span> <span class='ivar'>@transport</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span> <span class='op'>=</span> <span class='symbol'>:udp</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup_standalone-instance_method">
  
    - (<tt>Object</tt>) <strong>setup_standalone</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Setup standalone check executions, scheduling standard check definition and
check extension executions. Check definitions and extensions with
`:standalone` set to `true` will be scheduled by the Sensu client for
execution.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


291
292
293
294
295
296
297
298
299
300</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 291</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_standalone'>setup_standalone</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>scheduling standalone checks</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_standard_checks'>standard_checks</span> <span class='op'>=</span> <span class='ivar'>@settings</span><span class='period'>.</span><span class='id identifier rubyid_checks'>checks</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_check'>check</span><span class='op'>|</span>
    <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:standalone</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_extension_checks'>extension_checks</span> <span class='op'>=</span> <span class='ivar'>@extensions</span><span class='period'>.</span><span class='id identifier rubyid_checks'>checks</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_check'>check</span><span class='op'>|</span>
    <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:standalone</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:interval</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_schedule_checks'>schedule_checks</span><span class='lparen'>(</span><span class='id identifier rubyid_standard_checks'>standard_checks</span> <span class='op'>+</span> <span class='id identifier rubyid_extension_checks'>extension_checks</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup_subscriptions-instance_method">
  
    - (<tt>Object</tt>) <strong>setup_subscriptions</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set up Sensu client subscriptions. Subscriptions determine the kinds of
check requests the client will receive. A unique transport funnel is
created for the Sensu client, using a combination of it&#39;s name, the
Sensu version, and the current timestamp (epoch). The unique funnel is
bound to each transport pipe, named after the client subscription. The
Sensu client will receive JSON serialized check requests from its funnel,
that get parsed and processed.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 232</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_subscriptions'>setup_subscriptions</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>subscribing to client subscriptions</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:subscriptions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_subscription'>subscription</span><span class='op'>|</span>
    <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>subscribing to a subscription</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:subscription</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_subscription'>subscription</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_funnel'>funnel</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>VERSION</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='ivar'>@transport</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='symbol'>:fanout</span><span class='comma'>,</span> <span class='id identifier rubyid_subscription'>subscription</span><span class='comma'>,</span> <span class='id identifier rubyid_funnel'>funnel</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_message_info'>message_info</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_check'>check</span> <span class='op'>=</span> <span class='const'>MultiJson</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
        <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>received check request</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:check</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_process_check_request'>process_check_request</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>MultiJson</span><span class='op'>::</span><span class='const'>ParseError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
        <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed to parse the check request payload</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span>
          <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span>
          <span class='symbol'>:error</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
        <span class='rbrace'>}</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start-instance_method">
  
    - (<tt>Object</tt>) <strong>start</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Start the Sensu client process, setting up the client transport connection,
the sockets, and bootstrap.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


356
357
358
359
360</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 356</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span>
  <span class='id identifier rubyid_setup_transport'>setup_transport</span>
  <span class='id identifier rubyid_setup_sockets'>setup_sockets</span>
  <span class='id identifier rubyid_bootstrap'>bootstrap</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop-instance_method">
  
    - (<tt>Object</tt>) <strong>stop</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Stop the Sensu client process, pausing it, completing check executions in
progress, closing the transport connection, and exiting the process (exit
0). After pausing the process, the process/daemon state is set to
`:stopping`.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


400
401
402
403
404
405
406
407
408</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 400</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stopping</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pause'>pause</span>
  <span class='ivar'>@state</span> <span class='op'>=</span> <span class='symbol'>:stopping</span>
  <span class='id identifier rubyid_complete_checks_in_progress'>complete_checks_in_progress</span> <span class='kw'>do</span>
    <span class='ivar'>@transport</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="substitute_check_command_tokens-instance_method">
  
    - (<tt>Array</tt>) <strong>substitute_check_command_tokens</strong>(check) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Substitue check command tokens (eg. :::db.name|production:::) with the
associated client definition attribute value. Command tokens can provide a
fallback default value, following a pipe.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>check</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>containing the check command string with tokens substituted and an array of
unmatched command tokens.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122
123
124
125
126
127
128
129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sensu/client/process.rb', line 120</span>

<span class='kw'>def</span> <span class='id identifier rubyid_substitute_check_command_tokens'>substitute_check_command_tokens</span><span class='lparen'>(</span><span class='id identifier rubyid_check'>check</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_unmatched_tokens'>unmatched_tokens</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_substituted'>substituted</span> <span class='op'>=</span> <span class='id identifier rubyid_check'>check</span><span class='lbracket'>[</span><span class='symbol'>:command</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:::([^:].*?):::</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_default'>default</span> <span class='op'>=</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>|</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_matched'>matched</span> <span class='op'>=</span> <span class='id identifier rubyid_find_client_attribute'>find_client_attribute</span><span class='lparen'>(</span><span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_default'>default</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_matched'>matched</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_unmatched_tokens'>unmatched_tokens</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_matched'>matched</span>
  <span class='kw'>end</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_substituted'>substituted</span><span class='comma'>,</span> <span class='id identifier rubyid_unmatched_tokens'>unmatched_tokens</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Feb 10 17:09:29 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.2).
</div>

  </body>
</html>